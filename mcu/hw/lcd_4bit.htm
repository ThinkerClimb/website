<!--
 ____________________________________________________________
|                                                            |
|    DESIGN + Pat Heard { http://fullahead.org }             |
|      DATE + 2006.09.12                                     |
| COPYRIGHT + Free use if this notice is kept in place.      |
|____________________________________________________________|

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>司徒的教學網站</title>
  <meta http-lowast="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <meta name="author" content="fullahead.org" />
  <meta name="keywords" content="XHTML, CSS, template, FullAhead" />
  <meta name="description" content="A valid, XHTML 1.0 template" />
  <meta name="robots" content="index, follow, noarchive" />
  <meta name="googlebot" content="noarchive" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.1, maximum-scale=100.0"/>

  <link rel="shortcut icon" href="../../website.ico">
  <link rel="stylesheet" type="text/css" href="../../styles/shCore.css" />
  <link rel="stylesheet" type="text/css" href="../../styles/shThemeDefault.css" />
  <link rel="stylesheet" type="text/css" href="../../css/html.css" media="screen, projection, tv " />
  <link rel="stylesheet" type="text/css" href="../../css/layout.css" media="screen, projection, tv" />
  <link rel="stylesheet" type="text/css" href="../../css/print.css" media="print" />
  
  <script type="text/javascript" src="../../scripts/shCore.js"></script>
  <script type="text/javascript" src="../../scripts/shBrushCpp.js"></script>

  <!-- Conditional comment to apply opacity fix for IE #content background.
       Invalid CSS, but can be removed without harming design -->
  <!--[if gt IE 5]>
  <link rel="stylesheet" type="text/css" href="css/ie.css" media="screen, projection, tv " />
  <![endif]-->
</head>

<body>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<div id="wrapper">
<div id="content">
<script type="text/javascript" src="../../header.js"></script>
<div id="page">
<h3>Hardware</h3>
<p><b>LCD 4Bit</b></p>
<hr size="1">
<p>
對於I/O腳位比較少的微處理器，使用4-Bit方式去控制LCD是最適合的選擇，雖然4-Bit傳輸速度比較慢，但是LCD的更新速率本來就不會太快，所以使用4-Bit是相當足夠的。
</p>

<table>
  <thead>
    <tr>
      <th>LCD腳位</th>
      <th>功能說明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>GND</td>
    </tr>
    <tr>
      <td>2</td>
      <td>VCC</td>
    </tr>
    <tr>
      <td>3</td>
      <td>VEE(對比控制, GND最大)</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1: Data Register<hr/>0: Command Register</td>
    </tr>
    <tr>
      <td>5</td>
      <td>1: LCD Read<hr/>0: LCD Write</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Enable</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Data-0</td>
    </tr>
    <tr>
      <td>8</td>
      <td>Data-1</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Data-2</td>
    </tr>
    <tr>
      <td>10</td>
      <td>Data-3</td>
    </tr>
    <tr>
      <td>11</td>
      <td>Data-4</td>
    </tr>
    <tr>
      <td>12</td>
      <td>Data-5</td>
    </tr>
    <tr>
      <td>13</td>
      <td>Data-6</td>
    </tr>
    <tr>
      <td>14</td>
      <td>Data-7</td>
    </tr>
    <tr>
      <td>15</td>
      <td>BVCC(背光VCC)</td>
    </tr>
    <tr>
      <td>16</td>
      <td>BGND(背光GND)</td>
    </tr>
  </tbody>
</table>

<p>
RS和RW的組合配對，可以產生四種不同的控制方式
</p>

<table>
  <thead>
    <tr>
      <th>RS</th>
      <th>RW</th>
      <th>功能說明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>寫命令到LCD</td>
    </tr>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>讀取忙碌旗號和目前游標位址</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>寫資料到DDRAM(顯示的文字)或CGRAM(造字的字形)</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>從DDRAM或CGRAM讀取資料</td>
    </tr>
  </tbody>
</table>

<p>
LCD命令
</p>

<table>
  <thead>
    <tr>
      <th>RS</th>
      <th>RW</th>
      <th>D7</th>
      <th>D6</th>
      <th>D5</th>
      <th>D4</th>
      <th>D3</th>
      <th>D2</th>
      <th>D1</th>
      <th>D0</th>
      <th>需要執行時間</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1: 清除LCD畫面</td>
      <td>~2ms</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1: 游標回到原點位置</td>
      <td>X</td>
      <td>~2ms</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0: 游標固定不動<hr/>1: 游標自動加1</td>
      <td>0: LCD不自動位移<hr/>1: LCD自動位移</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0: 關閉LCD顯示<hr/>1: 開啟LCD顯示</td>
      <td>0: 關閉游標顯示<hr/>1: 開啟游標顯示</td>
      <td>0: 關閉游標閃爍<hr/>1: 開啟游標閃爍</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0: 關閉LCD位移功能<hr/>1: 開啟LCD位移功能</td>
      <td>0: 向左位移<hr/>1: 向右位移</td>
      <td>X</td>
      <td>X</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0: 4位元模式<hr/>1: 8位元模式</td>
      <td>0: 顯示1行<hr/>1: 顯示2行</td>
      <td>0: 5x7字型<hr/>1: 5x10字型</td>
      <td>X</td>
      <td>X</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td colspan="6">CGRAM Address</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td colspan="7">DDRAM Address</td>
      <td>~50us</td>
    </tr>
    <tr>
      <td>0</td>
      <td>1</td>
      <td colspan="8">讀取忙碌旗標</td>
      <td>~5us</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td colspan="8">寫資料到DDRAM或CGRAM</td>
      <td>~5us</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td colspan="8">從DDRAM或CGRAM讀取資料</td>
      <td>~5us</td>
    </tr>
  </tbody>
</table>

<p>
1行(1x20)LCD RAM的排列方式如下
</p>

<table>
  <thead>
    <tr>
      <th>第一行字元位址</th>
      <td>0x00</td><td>0x01</td><td>0x02</td><td>......</td><td>0x11</td><td>0x12</td><td>0x13</td>
    </tr>
  </thead>
</table>

<p>
2行(2x20)LCD RAM的排列方式如下</p>
<table>
  <thead>
    <tr>
      <th>第一行字元位址</th>
      <td>0x00</td><td>0x01</td><td>0x02</td><td>......</td><td>0x11</td><td>0x12</td><td>0x13</td>
    </tr>
    <tr>
      <th>第二行字元位址</th>
      <td>0x40</td><td>0x41</td><td>0x42</td><td>......</td><td>0x51</td><td>0x52</td><td>0x53</td>
    </tr>
  </thead>
</table>

<p>
4行(4x20)LCD RAM的排列方式如下</p>
<table>
  <thead>
    <tr>
      <th>第一行字元位址</th>
      <td>0x00</td><td>0x01</td><td>0x02</td><td>......</td><td>0x11</td><td>0x12</td><td>0x13</td>
    </tr>
    <tr>
      <th>第二行字元位址</th>
      <td>0x40</td><td>0x41</td><td>0x42</td><td>......</td><td>0x51</td><td>0x52</td><td>0x53</td>
    </tr>
    <tr>
      <th>第三行字元位址</th>
      <td>0x14</td><td>0x15</td><td>0x16</td><td>......</td><td>0x25</td><td>0x26</td><td>0x27</td>
    </tr>
    <tr>
      <th>第四行字元位址</th>
      <td>0x54</td><td>0x55</td><td>0x56</td><td>......</td><td>0x65</td><td>0x66</td><td>0x67</td>
    </tr>
  </tbody>
</table>

<p>
LCD 4-Bit的連接方式可以使用如下電路<br>
<img src="lcd_4bit/1.jpg" class="maxSize"><br>
每次傳送的命令或資料必須分成兩次傳送，先送出高4Bit，然後再送出低4Bit。
</p>

<p>
LCD 4-Bit初始化程式如下
</p>

<pre class="brush:cpp">
void DelayMS(unsigned int u16Delay)
{
  unsigned long u32DelayMS = 10000 * u16Delay;
  while(u32DelayMS--);
}

void LCD_Write_Command(unsigned char u8Command)
{
  LCD_RS = 0;
  LCD_Port = u8Command &amp; 0xf0;
  LCD_Enable = 1;
  DelayMS(1);
  LCD_Enable = 0;

  LCD_Port = (u8Command &lt;&lt; 4) &amp; 0xf0;
  LCD_Enable = 1;
  DelayMS(1);
  LCD_Enable = 0;
}

void LCD_Write_Data(unsigned char u8Data)
{
  LCD_RS = 1;
  LCD_Port = u8Data &amp; 0xf0;
  LCD_Enable = 1;
  DelayMS(1);
  LCD_Enable = 0;

  LCD_Port = (u8Data 4) &amp; 0xf0;
  LCD_Enable = 1;
  DelayMS(1);
  LCD_Enable = 0;
}

void Init_LCD(void)
{
  LCD_Write_Command(0x2e);
  DelayMS(2);
  LCD_Write_Command(0x0e);
  DelayMS(2);
  LCD_Write_Command(0x06);
  DelayMS(1);
  LCD_Write_Command(0x01);
  DelayMS(1);
  LCD_Write_Command(0x80);
  DelayMS(1);
}

void PutLCDString(char *pStr)
{
  unsigned char i=0;

  while(pStr[i] != 0x00){
   LCD_Write_Data(pStr[i]);
   i+= 1;
  }
}

void main(void)
{
  Init_LCD();
  PutLCDString("LCD 4-Bit Test !");
  while(1);
}
</pre>

<p>
<br><a href="../../mcu.htm">返回上一頁</a>
</p>

</div>
</div>
</div>
</body>
</html>
